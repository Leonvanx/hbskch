<!--
  功能：管理菜单
  作者：disonlv
  邮箱：disonlv@outlook.com
  时间：2025年04月09日 12:31:41
  版本：v1.0
  修改记录：
  修改内容：
  修改人员：
  修改时间：
-->
<template>
  <n-flex vertical class="common-page">
    <n-card class="search-part">
      <!-- 加上搜索功能/分类 -->
      <n-form ref="searchFormRef" class="search-form" label-placement="left" inline :label-width="80" :model="searchTarget" :rules="searchRules">
        <n-form-item path="name" label="标题">
          <n-input v-model:value="searchTarget.name" style="width: 150px" placeholder="请输入标题" />
        </n-form-item>
        <n-form-item path="subPath" label="子菜单">
          <n-select v-model:value="searchTarget.subPath" style="width: 150px" :options="selectOptions" placeholder="请选择子菜单" />
        </n-form-item>
        <n-form-item :show-label="false">
          <n-button type="primary" @click="add">新增</n-button>
        </n-form-item>
      </n-form>
    </n-card>
    <n-card class="table-part">
      <CTable :columns="columns" :data="tableData">
        <template #actions="{ row }">
          <n-space>
            <n-button strong tertiary size="small" @click="editRow(row)">编辑</n-button>
            <n-button strong tertiary size="small" @click="delRow(row)">删除</n-button>
          </n-space>
        </template>
      </CTable>
    </n-card>
    <n-card class="pagination-part">
      <n-flex justify="end">
        <n-pagination v-model:page="page" :page-count="100" :page-slot="7" />
      </n-flex>
    </n-card>
  </n-flex>
  <!-- 加一个侧边drawer -->
  <n-drawer v-model:show="drawerVisible" :width="502" placement="right" :on-esc="closed" :on-mask-click="() => closed()">
    <n-drawer-content>
      <template #header>
        {{ editTarget?.id ? '编辑文章' : '新增文章' }}
      </template>
      <template #footer>
        <n-space>
          <n-button @click="cancel">取消</n-button>
          <n-button type="primary" @click="submit">保存</n-button>
        </n-space>
      </template>
      <n-form ref="editFormRef" :model="editTarget" :rules="editRules">
        <n-form-item path="name" label="标题">
          <n-input v-model:value="editTarget.name" placeholder="请输入文章标题" />
        </n-form-item>
        <n-form-item path="subPath" label="展示子菜单">
          <n-select v-model:value="editTarget.subPath" :options="selectOptions" placeholder="请选择展示子菜单" />
        </n-form-item>
        <n-form-item path="isHomePage" label="在首页展示">
          <n-switch v-model:value="editTarget.isHomePage" :checked-value="1" :unchecked-value="0" />
        </n-form-item>
        <n-form-item path="isPathPage" label="在菜单展示">
          <n-switch v-model:value="editTarget.isPathPage" :checked-value="1" :unchecked-value="0" />
        </n-form-item>
        <n-form-item label="内容编辑">
          <RichTextEditor></RichTextEditor>
        </n-form-item>
      </n-form>
    </n-drawer-content>
  </n-drawer>
</template>

<script setup lang="ts">
import type { FormRules, FormInst } from 'naive-ui';

interface TextInfo {
  id?: string | number;
  name?: string;
  subPath?: string;
  pathName?: string;
  isHomePage?: number;
  isPathPage?: number;
  updateTime?: string;
}
const selectOptions = ref([
  { label: '全部', value: '' },
  {
    label: '菜单1',
    value: '1',
  },
  {
    label: '菜单2',
    value: '2',
  },
  {
    label: '菜单3',
    value: '3',
  },
]);
// 查找部分的变量
const searchRules: FormRules = {};
const searchFormRef = ref(null);
const searchTarget = ref<TextInfo>({
  name: '',
  subPath: '',
});
// 编辑部分的变量
const editRules: FormRules = {};
const editFormRef = ref<FormInst | null>(null);
const editTarget = ref<TextInfo>({
  name: '',
  subPath: '',
  isHomePage: 0,
  isPathPage: 0,
});

const drawerVisible = ref<boolean>(false);

const page = ref<number>(1);
const tableData = ref([
  {
    id: 1,
    name: 'John Brown',
    subPath: '1',
    pathName: '子菜单1',
    isHomePage: 1,
    isPathPage: 1,
    updateTime: '2025-04-01',
  },
  {
    id: 2,
    name: 'Jim Green',
    subPath: '2',
    pathName: '子菜单2',
    isHomePage: 1,
    isPathPage: 1,
    updateTime: '2025-04-01',
  },
  {
    id: 3,
    name: 'Joe Black',
    subPath: '3',
    pathName: '子菜单3',
    isHomePage: 1,
    isPathPage: 1,
    updateTime: '2025-04-01',
  },
]);
const columns = [
  {
    title: '文章标题',
    key: 'name',
  },
  {
    title: '子菜单',
    key: 'pathName',
  },
  {
    title: '在首页展示',
    key: 'isHomePage',
  },
  {
    title: '在菜单展示',
    key: 'isPathPage',
  },
  {
    title: '更新时间',
    key: 'updateTime',
  },
  {
    title: '操作',
    key: 'actions',
  },
];
const editRow = (row: TextInfo) => {
  editTarget.value = { ...row };
  drawerVisible.value = true;
};
const delRow = (row: TextInfo) => {
  console.log('🚀 ~ delRow ~ row:', row);
};
const add = () => {
  editTarget.value = {};
  drawerVisible.value = true;
};
const submit = () => {
  console.log('submit');
  closed();
};
const cancel = () => {
  closed();
};
const closed = () => {
  drawerVisible.value = false;
  editTarget.value = {};
};
</script>

<style scoped lang="scss">
.common-page {
  width: 100%;
  height: 100%;
  .search-part {
    .search-form {
      margin-bottom: -24px !important;
    }
  }
  .table-part {
    flex: 1;
  }
  .pagination-part {
  }
}
</style>
